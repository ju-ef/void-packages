# Template file for 'Rocket.Chat-Desktop'
pkgname=Rocket.Chat-Desktop
version=3.9.11
revision=1
_electron_ver=24
hostmakedepends="yarn nodejs python3 pkg-config app-builder"
makedepends="electron${_electron_ver} libvips-devel"
depends="electron${_electron_ver}"
short_desc="Rocket.Chat Native Cross-Platform Desktop Application via Electron"
maintainer="John <me@johnnynator.dev>"
license="MIT"
homepage="https://rocket.chat/"
distfiles="https://github.com/RocketChat/Rocket.Chat.Electron/archive/${version}.tar.gz"
checksum=936525dd74dcc9050bfb91ecf4ce80d6a5be38de8bfbb9b05f2faac7b3a9a580

export USE_SYSTEM_APP_BUILDER=true

do_build() {
	export NODE_ENV=production
	yarn install
	yarn build
	yarn run electron-builder --linux --x64 --dir \
		-c.electronDist=/usr/lib/electron${_electron_ver} \
		-c.electronVersion="$(</usr/lib/electron${_electron_ver}/version)"
}
do_install() {
	vinstall "${FILESDIR}/Rocket.Chat-Desktop.desktop" 644 usr/share/applications
	cat > Rocket.Chat-Desktop <<-EOF
	#!/bin/sh
	exec electron${_electron_ver} /usr/lib/Rocket.Chat-Desktop.asar "\$@"
	EOF
	vbin Rocket.Chat-Desktop
	vinstall build/icons/512x512.png 644 usr/share/icons/hicolor/512x512/apps Rocket.Chat-Desktop.png
	vlicense LICENSE
	vinstall "dist/linux-unpacked/resources/app.asar" 644 /usr/lib Rocket.Chat-Desktop.asar
}
